<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inkognitos Forum — Login</title>
  <meta name="description" content="Login-Seite für Inkognitos Forum">
  <style>
    :root{
      --bg:#0b0914; --bg2:#120e1f;
      --glass:rgba(26,20,39,0.65); --glass2:rgba(20,15,32,0.6);
      --border:rgba(255,255,255,.12); --text:#e6e0f9; --muted:#a49bbd;
      --accent:#9b5dff; --accent2:#6d28d9; --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Arial,sans-serif; color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(124,58,237,.25), transparent 60%),
        radial-gradient(1200px 800px at 80% 90%, rgba(167,139,250,.18), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      display:grid; place-items:center; min-height:100dvh;
    }
    .glass{background:var(--glass); border:1px solid var(--border); border-radius:var(--radius);
      backdrop-filter: blur(16px) saturate(120%); -webkit-backdrop-filter: blur(16px) saturate(120%);
      box-shadow:0 12px 30px rgba(0,0,0,.45)}
    .card{width:min(420px,92vw); padding:18px}
    .brand{display:flex; gap:12px; align-items:center; margin-bottom:8px}
    .logo{width:46px; height:46px; border-radius:16px; display:grid; place-items:center; color:#0b0914; font-weight:900;
      background:conic-gradient(from 210deg, #9b5dff, #6d28d9, #9b5dff); box-shadow:0 10px 24px rgba(155,93,255,.35)}
    h1{margin:0; font-size:1.24rem}
    .muted{color:var(--muted)}
    input,button{font:inherit}
    input{
      width:100%; margin-top:8px; background:rgba(255,255,255,.08); color:var(--text);
      border:1px solid rgba(255,255,255,.18); border-radius:14px; padding:12px 14px; outline:none;
    }
    input:focus{border-color:var(--accent); box-shadow:0 0 0 4px rgba(155,93,255,.18)}
    .btn{display:inline-grid; place-items:center; padding:12px 16px; border-radius:999px; color:white; font-weight:800;
      cursor:pointer; user-select:none; border:none}
    .primary{background:linear-gradient(135deg, #9b5dff, #6d28d9); box-shadow:0 8px 22px rgba(155,93,255,.35)}
    .row{display:grid; gap:10px; margin-top:12px}
    .center{display:grid; place-items:center; gap:6px; margin-top:10px}
    .link{color:#c9b7ff; text-decoration:none}
  </style>
</head>
<body>
  <div class="glass card">
    <div class="brand">
      <div class="logo">IF</div>
      <div><h1>Inkognitos Forum</h1><div class="muted">Bitte anmelden</div></div>
    </div>
    <div class="row">
      <label>E-Mail<input id="email" autocomplete="username" placeholder="name@mail.de"></label>
      <label>Passwort<input id="pass" type="password" autocomplete="current-password" placeholder="••••••••"></label>
      <button id="loginBtn" class="btn primary">Anmelden</button>
      <div id="status" class="muted" role="status"></div>
    </div>
    <div class="center">
      <small class="muted">Noch nicht eingeloggt? Nach erfolgreichem Login geht’s automatisch weiter.</small>
      <a class="link" href="index.html">Zur Startseite</a>
    </div>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBN60Xp5JfDZVHPQeUH4ZnGS9eZf1ebscM",
      authDomain: "datenbankrp.firebaseapp.com",
      projectId: "datenbankrp",
      storageBucket: "datenbankrp.firebasestorage.app",
      messagingSenderId: "334767405699",
      appId: "1:334767405699:web:d8d3ec72401b69d113f9b6"
    };
    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth(); const db=firebase.firestore();

    async function ensureProfile(uid, email){
      const ref=db.collection('profiles').doc(uid);
      const snap=await ref.get();
      if(!snap.exists){
        await ref.set({ display_name: email||'User', role:'user', disabled:false });
      }
      return (await ref.get()).data();
    }

    // Weiterleitung, wenn bereits eingeloggt
    auth.onAuthStateChanged(async (user)=>{
      if(user){
        const p=await ensureProfile(user.uid, user.email);
        if(p.disabled){ document.getElementById('status').textContent='Konto gesperrt. Wende dich an den Admin.'; await auth.signOut(); return; }
        window.location.href='index.html';
      }
    });

    document.getElementById('loginBtn').addEventListener('click', async ()=>{
      const email=document.getElementById('email').value.trim();
      const pass=document.getElementById('pass').value.trim();
      const s=document.getElementById('status'); s.textContent='Anmeldung…';
      try{
        const cred=await auth.signInWithEmailAndPassword(email,pass);
        const u=cred.user; const p=await ensureProfile(u.uid, u.email);
        if(p.disabled){ s.textContent='Konto gesperrt.'; await auth.signOut(); return; }
        s.textContent='Erfolgreich. Weiterleitung…'; window.location.href='index.html';
      }catch(e){ console.error(e); s.textContent='Login fehlgeschlagen.'; }
    });
  </script>
</body>
</html>
