<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard ‚Äî Telefonbuch ¬∑ Notizen ¬∑ F√§lle</title>
  <meta name="description" content="Lokales Dashboard mit Telefonbuch, Notizen und Fallverwaltung. Apple-inspiriertes Dark-Design (Glas ¬∑ sanfte, federnde Animationen) + Startsound (Upload oder Synth)." />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <style>
    /* =========================================================
       Apple-orientiert ¬∑ DARK ¬∑ Blue Accent ¬∑ Glass + Bounce
       ========================================================= */
    :root{
      --bg:#0b1220; --bg2:#0a101c; --glass:rgba(10,16,28,.55); --glass2:rgba(12,18,32,.45);
      --border:rgba(255,255,255,.12); --text:#e9eef6; --muted:#a6b0c3;
      --accent:#0a84ff; --accent2:#5ac8fa; --ok:#22c55e; --danger:#ef4444; --warn:#f59e0b;
      --radius:18px; --gap:14px; --maxw:1280px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "SF Pro Text", "Segoe UI", Roboto, Arial; color:var(--text);
      background: radial-gradient(1400px 900px at 15% 10%, #0f1a2f 0%, var(--bg2) 55%, #070c16 100%); overflow-x:hidden}

    /* ===== Animated background blobs (blueish) ===== */
    .blob{position:fixed; filter:blur(48px); opacity:.5; z-index:-2; animation:float 22s ease-in-out infinite}
    .b1{top:-160px; left:-200px; width:560px; height:560px; background:radial-gradient(circle at 30% 30%, rgba(10,132,255,.65), transparent 60%)}
    .b2{bottom:-180px; right:-240px; width:620px; height:620px; background:radial-gradient(circle at 70% 70%, rgba(90,200,250,.55), transparent 60%); animation-delay:-8s}
    .b3{top:45%; left:60%; width:420px; height:420px; background:radial-gradient(circle at 40% 60%, rgba(72,149,239,.45), transparent 60%); animation-delay:-3s}
    @keyframes float{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(14px,-22px) scale(1.04)}}
    @media (prefers-reduced-motion: reduce){ .blob{animation:none} }

    /* ===== Layout ===== */
    .app{display:grid; grid-template-columns:300px 1fr; min-height:100dvh}
    @media (max-width:1024px){ .app{grid-template-columns:1fr} }

    /* ===== Sidebar & Hamburger ===== */
    .hamburger{display:none; position:fixed; top:14px; left:14px; z-index:10; width:46px; height:46px; border-radius:14px; border:1px solid var(--border); background:var(--glass2); backdrop-filter:blur(12px); cursor:pointer}
    .hamburger span, .hamburger::before, .hamburger::after{content:""; position:absolute; left:12px; right:12px; height:2px; background:#e9eef6; border-radius:2px; transition:.24s cubic-bezier(.2,1,.2,1)}
    .hamburger span{top:22px}
    .hamburger::before{top:14px}
    .hamburger::after{top:30px}
    @media (max-width:1024px){ .hamburger{display:block} }

    .sidebar{position:sticky; top:0; align-self:start; height:100dvh; padding:18px; backdrop-filter:blur(22px) saturate(120%); -webkit-backdrop-filter:blur(22px) saturate(120%);
      background:linear-gradient(180deg, var(--glass), var(--glass2)); border-right:1px solid var(--border)}
    .brand{display:flex; gap:12px; align-items:center; margin-bottom:16px}
    .logo{width:46px; height:46px; border-radius:16px; background:linear-gradient(135deg,#0a84ff,#5ac8fa); display:grid; place-items:center; color:#061120; font-weight:900; box-shadow:0 8px 24px rgba(2,6,23,.35)}
    .brand h1{margin:0; font-size:1.24rem}

    .nav{display:grid; gap:10px; margin-top:12px}
    .nav button{all:unset; display:flex; align-items:center; gap:10px; padding:12px 14px; border-radius:14px; cursor:pointer; color:var(--text); border:1px solid transparent}
    .nav button:hover{background:rgba(255,255,255,.06); border-color:rgba(255,255,255,.14)}
    .nav button.active{background:linear-gradient(135deg, rgba(10,132,255,.22), rgba(90,200,250,.18)); border-color:rgba(255,255,255,.22)}

    .settings{margin-top:18px; display:grid; gap:8px}
    .settings .hint{font-size:.9rem; color:var(--muted)}

    @media (max-width:1024px){
      .sidebar{position:fixed; left:-100%; width:min(320px,90vw); transition:left .26s cubic-bezier(.2,.9,.2,1); box-shadow:0 16px 40px rgba(0,0,0,.5)}
      .sidebar.open{left:0}
      .app{grid-template-columns:1fr}
    }

    .main{padding:24px; max-width:var(--maxw); width:100%; margin:0 auto}
    .glass{background:var(--glass); border:1px solid var(--border); border-radius:var(--radius); backdrop-filter: blur(16px) saturate(120%); -webkit-backdrop-filter: blur(16px) saturate(120%); box-shadow: 0 10px 30px rgba(0,0,0,.45)}
    .section{padding:16px; margin-bottom:16px}

    input, button, textarea{font:inherit}
    /* Force dark glass inputs everywhere (fix white fields) */
    input:not([type="file"]):not([type="checkbox"]):not([type="radio"]),
    input[type="search"],
    textarea,
    select{
      background:rgba(255,255,255,.06) !important; color:var(--text) !important; border:1px solid rgba(255,255,255,.18) !important; border-radius:14px !important; padding:12px 14px !important; outline:none !important; backdrop-filter:blur(8px) !important; -webkit-appearance:none; appearance:none
    }
    input:focus, textarea:focus, select:focus{border-color:var(--accent) !important; box-shadow:0 0 0 4px rgba(10,132,255,.18) !important}
    ::placeholder{color:#aab4c6}
    /* Fix autofill white background on Chrome */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus{
      -webkit-text-fill-color:var(--text);
      transition: background-color 9999s ease-out;
      box-shadow:0 0 0px 1000px rgba(255,255,255,.06) inset;
      caret-color:var(--text);
    }
    textarea{min-height:120px; resize:vertical}

    /* ===== Liquid (glassy) buttons ===== */
    .btn{display:inline-grid; place-items:center; padding:12px 16px; border-radius:999px; color:white; font-weight:800; cursor:pointer; user-select:none; border:none; position:relative; isolation:isolate; transition:transform .24s cubic-bezier(.2,1.2,.2,1), filter .2s}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2)); box-shadow:0 6px 18px rgba(10,132,255,.35)}
    .btn.ghost{background:linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.12)); color:#e9eef6; border:1px solid rgba(255,255,255,.16)}
    .btn.danger{background:linear-gradient(135deg, rgba(239,68,68,.9), rgba(239,68,68,.7))}
    .btn:active{transform:scale(.97)}

    .pill{padding:8px 12px; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.16)}

    .row{display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:var(--gap)}
    @media (max-width:900px){ .row{grid-template-columns:1fr 1fr} }
    @media (max-width:560px){ .row{grid-template-columns:1fr} }

    table{width:100%; border-collapse:separate; border-spacing:0}
    thead th{position:sticky; top:0; background:rgba(13,19,32,.7); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px); z-index:1}
    th, td{padding:12px 10px; text-align:left; border-bottom:1px solid rgba(255,255,255,.08)}
    tbody tr{transition:background .15s}
    tbody tr:hover{background:rgba(255,255,255,.05)}
    .actions{display:flex; gap:8px}

    .muted{color:var(--muted)}
    .hidden{display:none !important}

    /* Fade-in */
    .fade-in{animation:fade .34s cubic-bezier(.2,.9,.2,1)}
    @keyframes fade{from{opacity:0; transform:translateY(8px) scale(.995)} to{opacity:1; transform:translateY(0) scale(1)}}

    /* ===== Splash (Welcome) ===== */
    .splash{position:fixed; inset:0; display:grid; place-items:center; background:radial-gradient(1400px 900px at 50% 40%, #0f1a2f 0%, #091222 70%); z-index:50}
    .splash .box{text-align:center}
    .splash h2{margin:0; font-size:clamp(1.6rem,4vw,2.6rem)}
    .splash.fadeout{animation:splashout .7s cubic-bezier(.2,1,.2,1) forwards}
    @keyframes splashout{to{opacity:0; transform:scale(1.02); visibility:hidden}}
    /* Loading dots */
    .dot{display:inline-block; width:0.6ch; text-align:left; opacity:0}
    @keyframes blink{0%,20%{opacity:0}40%,100%{opacity:1}}
    .dot1{animation:blink 1.2s infinite}
    .dot2{animation:blink 1.2s infinite .2s}
    .dot3{animation:blink 1.2s infinite .4s}
    /* Loading dots */
    .dot{display:inline-block; width:0.6ch; text-align:left; opacity:0}
    @keyframes blink{0%,20%{opacity:0}40%,100%{opacity:1}}
    .dot1{animation:blink 1.2s infinite}
    .dot2{animation:blink 1.2s infinite .2s}
    .dot3{animation:blink 1.2s infinite .4s}
  </style>
</head>
<body>
  <!-- background blobs -->
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <!-- Splash welcome -->
  <div class="splash" id="splash">
    <div class="box">
      <h2>Willkommen</h2>
      <div class="muted" style="margin-top:.35rem">Dashboard wird geladen<span class="dot dot1">.</span><span class="dot dot2">.</span><span class="dot dot3">.</span></div>
    </div>
  </div>
    </div>
  </div>
    </div>
  </div>

  <button class="hamburger" id="hamburger" aria-label="Men√º √∂ffnen"><span></span></button>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar glass" id="sidebar" aria-label="Navigation">
      <div class="brand">
        <div class="logo">DB</div>
        <div>
          <h1>Dashboard</h1>
          <div class="muted">Lokal gespeichert (localStorage)</div>
        </div>
      </div>
      <nav class="nav" id="nav">
        <button data-page="contacts" class="active">üìá Telefonbuch</button>
        <button data-page="notes">üóíÔ∏è Notizen</button>
        <button data-page="cases">üïµÔ∏è‚Äç‚ôÇÔ∏è F√§lle</button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Contacts Page -->
      <section id="page-contacts" class="fade-in">
        <header class="glass section" style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap">
          <div style="display:flex; gap:10px; align-items:center">
            <input id="search" type="search" placeholder="Suche: Name, Nummer, Notiz‚Ä¶" aria-label="Suche" />
            <span class="pill">Sortieren</span>
            <button class="btn ghost" data-sort="name" title="Nach Name sortieren">Name</button>
            <button class="btn ghost" data-sort="phone" title="Nach Nummer sortieren">Telefon</button>
          </div>
          <div style="display:flex; gap:10px">
            <button id="exportContacts" class="btn primary" title="Export JSON">Export</button>
            <label for="importContactsFile" style="display:inline-grid"><input id="importContactsFile" type="file" accept="application/json" class="hidden" /><button id="importContacts" class="btn primary">Import</button></label>
            <button id="clearContacts" class="btn danger" title="Alle Eintr√§ge l√∂schen">Alles l√∂schen</button>
          </div>
        </header>

        <section class="glass section">
          <h2 style="margin:0 0 8px 0">Kontakt hinzuf√ºgen</h2>
          <div class="row">
            <label> Name <input id="name" placeholder="Anna M√ºller" autocomplete="name" /></label>
            <label> Telefon <input id="phone" placeholder="+49 176 1234567" inputmode="tel" /></label>
            <label> Notiz <input id="note" placeholder="z. B. Schule" /></label>
            <div style="display:grid;align-content:end"><button id="addContact" class="btn primary">Hinzuf√ºgen</button></div>
          </div>
        </section>

        <section class="glass section" style="overflow:auto; max-height:60vh">
          <table aria-label="Kontaktliste">
            <thead>
              <tr><th>Name</th><th>Telefon</th><th>Notiz</th><th>Aktionen</th></tr>
            </thead>
            <tbody id="contactsBody"></tbody>
          </table>
        </section>
      </section>

      <!-- Notes Page -->
      <section id="page-notes" class="hidden fade-in">
        <section class="glass section">
          <h2 style="margin:0 0 8px 0">Neue Notiz</h2>
          <div class="row" style="grid-template-columns:1fr 1fr auto">
            <label>Titel <input id="noteTitle" placeholder="z. B. Einkaufsliste" /></label>
            <label>Tags <input id="noteTags" placeholder="z. B. Schule, Projekt" /></label>
            <div style="display:grid;align-content:end"><button id="addNote" class="btn primary">Speichern</button></div>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); margin-top:var(--gap)">
            <label style="display:block">Bild (optional)
              <input id="noteImage" type="file" accept="image/*" />
            </label>
            <label style="display:block">Text
              <textarea id="noteText" placeholder="Schreibe deine Notiz‚Ä¶"></textarea>
            </label>
          </div>
          <div class="muted" style="margin-top:6px">Bilder werden lokal als Data-URL gespeichert.</div>
        </section>

        <section class="glass section" style="overflow:auto; max-height:60vh">
          <table aria-label="Notizliste">
            <thead>
              <tr><th>Titel</th><th>Tags</th><th>Bild</th><th>Aktionen</th></tr>
            </thead>
            <tbody id="notesBody"></tbody>
          </table>
        </section>
      </section>

      <!-- Cases Page (KriPo) -->
      <section id="page-cases" class="hidden fade-in">
        <section class="glass section">
          <h2 style="margin:0 0 8px 0">Neuer Fall</h2>
          <div class="row" style="grid-template-columns:1fr 1fr 1fr auto">
            <label>Titel <input id="caseTitle" placeholder="z. B. Diebstahl im Park" /></label>
            <label>Aktenzeichen <input id="caseNumber" placeholder="z. B. 2025-001" /></label>
            <label>Status <input id="caseStatus" placeholder="z. B. offen/erledigt" /></label>
            <div style="display:grid;align-content:end"><button id="addCase" class="btn primary">Anlegen</button></div>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); margin-top:var(--gap)">
            <label>Personen/Beteiligte <input id="casePeople" placeholder="Namen, Rollen" /></label>
            <label>Tags <input id="caseTags" placeholder="Tatort, Kategorie‚Ä¶" /></label>
          </div>
          <div style="margin-top:var(--gap)">
            <label>Beschreibung
              <textarea id="caseDesc" placeholder="Kurzbeschreibung des Falls‚Ä¶"></textarea>
            </label>
          </div>
        </section>

        <section class="glass section" style="overflow:auto; max-height:60vh">
          <table aria-label="F√§lle">
            <thead>
              <tr><th>Aktenzeichen</th><th>Titel</th><th>Status</th><th>Aktionen</th></tr>
            </thead>
            <tbody id="casesBody"></tbody>
          </table>
        </section>
      </section>
    </main>
  </div>

  <script>
    // ===== Helpers & storage =====
    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
    const uid = ()=>Math.random().toString(36).slice(2,10);
    const escapeHtml = s => (s+'').replace(/[&<>"']/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch]));

    const STORE_CONTACTS='ui_contacts_dark_blue_v1';
    const STORE_NOTES='ui_notes_dark_blue_v1';
    const STORE_CASES='ui_cases_dark_blue_v1';
    

    const state={contacts:[], notes:[], cases:[], sortBy:'name', sortDir:'asc', q:''};

    const save=()=>{ try{localStorage.setItem(STORE_CONTACTS,JSON.stringify(state.contacts))}catch{}; try{localStorage.setItem(STORE_NOTES,JSON.stringify(state.notes))}catch{}; try{localStorage.setItem(STORE_CASES,JSON.stringify(state.cases))}catch{} };
    const load=()=>{ try{state.contacts=JSON.parse(localStorage.getItem(STORE_CONTACTS)||'[]')}catch{}; try{state.notes=JSON.parse(localStorage.getItem(STORE_NOTES)||'[]')}catch{}; try{state.cases=JSON.parse(localStorage.getItem(STORE_CASES)||'[]')}catch{} };

    // ===== Navigation + Splash + Startup-Sound =====
    function switchPage(page){
      $$('#nav button').forEach(b=>b.classList.toggle('active', b.dataset.page===page));
      $('#page-contacts').classList.toggle('hidden', page!=='contacts');
      $('#page-notes').classList.toggle('hidden', page!=='notes');
      $('#page-cases').classList.toggle('hidden', page!=='cases');
      if(matchMedia('(max-width:1024px)').matches) $('#sidebar').classList.remove('open');
    }

    let audioCtx; 
    async function playStartup(){ try{ const a=document.getElementById('startupAudio'); a && a.play().catch(()=>{}); }catch(e){} }); }catch(e){} } else {
          // synth fallback (blue chime)
          audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
          const t = audioCtx.currentTime;
          const gain = audioCtx.createGain(); gain.gain.value = 0.0001; gain.connect(audioCtx.destination);
          const env = (when,dur)=>{ gain.gain.setValueAtTime(0.0001, when); gain.gain.exponentialRampToValueAtTime(0.18, when+0.02); gain.gain.exponentialRampToValueAtTime(0.0001, when+dur); };
          [523.25,659.25,783.99].forEach((f,i)=>{ const o=audioCtx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(f, t); o.connect(gain); o.start(t+0.03*i); o.stop(t+1.3); });
          env(t,1.3);
        }
      }catch(e){ /* autoplay block -> handled by first interaction */ }
    }

    function hideSplash(){ const s=$('#splash'); s.classList.add('fadeout'); setTimeout(()=>s.remove(), 700); }

    // ===== Contacts =====
    function renderContacts(){
      let list=[...state.contacts];
      if(state.q){ const q=state.q.toLowerCase(); list=list.filter(c=>(c.name||'').toLowerCase().includes(q)||(c.phone||'').toLowerCase().includes(q)||(c.note||'').toLowerCase().includes(q)); }
      list.sort((a,b)=>{ const k=state.sortBy; const A=(a[k]||'').toLowerCase(); const B=(b[k]||'').toLowerCase(); if(A<B)return state.sortDir==='asc'?-1:1; if(A>B)return state.sortDir==='asc'?1:-1; return 0;});
      const tbody=$('#contactsBody'); tbody.innerHTML='';
      for(const c of list){
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${escapeHtml(c.name)}</td>
          <td><a href="tel:${encodeURIComponent(c.phone)}" style="color:var(--accent)">${escapeHtml(c.phone)}</a></td>
          <td>${escapeHtml(c.note||'')}</td>
          <td class="actions">
            <button class="btn ghost" data-act="edit" data-id="${c.id}">Bearbeiten</button>
            <button class="btn danger" data-act="del" data-id="${c.id}">L√∂schen</button>
          </td>`;
        tbody.appendChild(tr);
      }
    }
    function addContact(n,p,nt){ state.contacts.push({id:uid(),name:n.trim(),phone:p.trim(),note:(nt||'').trim()}); save(); renderContacts(); }
    function updateContact(id,patch){ const i=state.contacts.findIndex(x=>x.id===id); if(i>-1){ state.contacts[i]={...state.contacts[i],...patch}; save(); renderContacts(); }}
    function deleteContact(id){ state.contacts=state.contacts.filter(x=>x.id!==id); save(); renderContacts(); }

    // ===== Notes =====
    function renderNotes(){ const tbody=$('#notesBody'); tbody.innerHTML=''; for(const n of state.notes){ const tr=document.createElement('tr'); const thumb=n.image?`<img src="${n.image}" alt="Bild" style="width:64px;height:64px;object-fit:cover;border-radius:12px;border:1px solid var(--border)"/>`:'<span class="muted">‚Äì</span>'; tr.innerHTML=`<td>${escapeHtml(n.title||'Ohne Titel')}</td><td>${escapeHtml(n.tags||'')}</td><td>${thumb}</td><td class="actions"><button class="btn ghost" data-act="open" data-id="${n.id}">√ñffnen</button><button class="btn danger" data-act="del-note" data-id="${n.id}">L√∂schen</button></td>`; tbody.appendChild(tr);} }
    function addNote(note){ state.notes.unshift({id:uid(),...note}); save(); renderNotes(); }
    function deleteNote(id){ state.notes=state.notes.filter(x=>x.id!==id); save(); renderNotes(); }

    function openNoteModal(n){ const modal=document.createElement('div'); modal.className='glass fade-in'; modal.style.cssText='position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,6,23,.55);padding:20px;z-index:40'; const box=document.createElement('div'); box.className='glass'; box.style.cssText='max-width:920px;width:95vw;border-radius:20px;padding:18px;'; box.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;gap:10px"><h3 style="margin:0">${escapeHtml(n.title||'Ohne Titel')}</h3><button id="closeModal" class="btn ghost">Schlie√üen</button></div><div class="muted" style="margin:.25rem 0">${escapeHtml(n.tags||'')}</div><div style="display:grid;grid-template-columns:300px 1fr;gap:14px;margin-top:12px"><div>${n.image?`<img src="${n.image}" alt="Bild" style="width:100%;border-radius:16px;border:1px solid var(--border);object-fit:cover"/>`:'<div class="muted">Kein Bild</div>'}</div><div style="white-space:pre-wrap">${escapeHtml(n.text||'')}</div></div>`; modal.appendChild(box); modal.addEventListener('click',e=>{ if(e.target===modal||e.target.id==='closeModal') modal.remove();}); document.body.appendChild(modal); }

    // ===== Cases (KriPo-Seite) =====
    function renderCases(){ const tbody=$('#casesBody'); tbody.innerHTML=''; for(const c of state.cases){ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(c.number||'‚Äî')}</td><td>${escapeHtml(c.title||'')}</td><td>${escapeHtml(c.status||'')}</td><td class="actions"><button class="btn ghost" data-act="open-case" data-id="${c.id}">√ñffnen</button><button class="btn danger" data-act="del-case" data-id="${c.id}">L√∂schen</button></td>`; tbody.appendChild(tr);} }
    function addCase(obj){ state.cases.unshift({id:uid(), ...obj, interrogations:[], images:[]}); save(); renderCases(); }
    function deleteCase(id){ state.cases=state.cases.filter(x=>x.id!==id); save(); renderCases(); }

    function openCaseModal(c){ const modal=document.createElement('div'); modal.className='glass fade-in'; modal.style.cssText='position:fixed;inset:0;display:grid;place-items:center;background:rgba(2,6,23,.55);padding:20px;z-index:40'; const box=document.createElement('div'); box.className='glass'; box.style.cssText='max-width:1000px;width:96vw;border-radius:20px;padding:18px;'; box.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><h3 style="margin:0">${escapeHtml(c.title)} <span class="pill" style="margin-left:8px">${escapeHtml(c.number)}</span></h3><button id="closeCase" class="btn ghost">Schlie√üen</button></div><div class="muted" style="margin:.3rem 0">Status: ${escapeHtml(c.status||'‚Äî')} ¬∑ Tags: ${escapeHtml(c.tags||'‚Äî')}</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:12px"><div><h4>Beteiligte</h4><div class="glass" style="padding:10px;border-radius:14px">${escapeHtml(c.people||'‚Äî')}</div><h4 style="margin-top:12px">Beschreibung</h4><div class="glass" style="padding:10px;border-radius:14px;white-space:pre-wrap">${escapeHtml(c.desc||'‚Äî')}</div></div><div><h4>Verh√∂re</h4><div id="interroList" class="glass" style="padding:10px;border-radius:14px;max-height:220px;overflow:auto">${(c.interrogations||[]).map(x=>`<div style='border-bottom:1px solid rgba(255,255,255,.08);padding:6px 0'><strong>${escapeHtml(x.when)}</strong><div style='white-space:pre-wrap'>${escapeHtml(x.text)}</div></div>`).join('') || '<div class="muted">Keine Eintr√§ge</div>'}</div><div style="display:grid;grid-template-columns:1fr auto;gap:8px;margin-top:10px"><input id="interroText" placeholder="Verh√∂rnotiz‚Ä¶"/><button id="addInterro" class="btn primary">Hinzuf√ºgen</button></div><h4 style="margin-top:12px">Bilder</h4><div id="imgWrap" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px">${(c.images||[]).map(u=>`<img src='${u}' alt='Bild' style='width:100%;height:90px;object-fit:cover;border-radius:12px;border:1px solid var(--border)'/>`).join('')}</div><label class="btn primary" style="margin-top:8px;display:inline-grid"><input id="caseImgInput" type="file" accept="image/*" class="hidden"/>Bild hochladen</label></div></div>`; modal.appendChild(box);
      modal.addEventListener('click',e=>{ if(e.target===modal||e.target.id==='closeCase'){ modal.remove(); }});
      box.querySelector('#addInterro').addEventListener('click',()=>{ const t=box.querySelector('#interroText').value.trim(); if(!t) return; const entry={when:new Date().toLocaleString(), text:t}; c.interrogations.unshift(entry); save(); openCaseModalReplace(modal, c); });
      box.querySelector('#caseImgInput').addEventListener('change', async (e)=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; const url=await readAsDataURL(f); (c.images||(c.images=[])).push(url); save(); openCaseModalReplace(modal, c); });
      document.body.appendChild(modal);
    }
    function openCaseModalReplace(modal,c){ modal.remove(); openCaseModal(c); renderCases(); }

    const readAsDataURL=(file)=>new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); });

    // ===== Init =====
    function init(){
      load(); renderContacts(); renderNotes(); renderCases();
      // Play startup sound immediately on load (may be blocked by some browsers)
      playStartup();
      // try again when page becomes visible (if first attempt was blocked)
      document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible') playStartup(); }, {once:true});
      // Timeline: 0s splash, 2s sound start, 3s fade out
      setTimeout(()=>{ playStartup(); }, 2000);
      setTimeout(()=>{ const s=$('#splash'); s.classList.add('fadeout'); setTimeout(()=>s.remove(), 700); }, 3000);

      // Sidebar
      $('#hamburger').addEventListener('click',()=>$('#sidebar').classList.toggle('open'));
      $$('#nav button').forEach(btn=>btn.addEventListener('click',()=>switchPage(btn.dataset.page)));

      // Contacts events
      $('#addContact').addEventListener('click',()=>{ const n=$('#name').value, p=$('#phone').value, nt=$('#note').value; if(!n.trim()) return alert('Bitte Namen eingeben.'); if(!p.trim()) return alert('Bitte Telefonnummer eingeben.'); addContact(n,p,nt); $('#name').value=$('#phone').value=$('#note').value=''; $('#name').focus(); });
      $('#search').addEventListener('input',e=>{ state.q=e.target.value; renderContacts(); });
      $$('button[data-sort]').forEach(b=>b.addEventListener('click',()=>{ const k=b.dataset.sort; if(state.sortBy===k) state.sortDir=state.sortDir==='asc'?'desc':'asc'; else{ state.sortBy=k; state.sortDir='asc'; } renderContacts(); }));
      $('#contactsBody').addEventListener('click',e=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; const act=btn.dataset.act; const c=state.contacts.find(x=>x.id===id); if(!c) return; if(act==='del'){ if(confirm('Kontakt l√∂schen?')) deleteContact(id); } if(act==='edit'){ const tr=btn.closest('tr'); tr.innerHTML=`<td><input id=\"e_name\" value=\"${escapeHtml(c.name)}\"/></td><td><input id=\"e_phone\" value=\"${escapeHtml(c.phone)}\"/></td><td><input id=\"e_note\" value=\"${escapeHtml(c.note||'')}\"/></td><td class=\"actions\"><button class=\"btn primary\" data-act=\"save\" data-id=\"${c.id}\">Speichern</button><button class=\"btn danger\" data-act=\"cancel\">Abbrechen</button></td>`; } if(act==='save'){ const tr=btn.closest('tr'); const n=tr.querySelector('#e_name').value; const p=tr.querySelector('#e_phone').value; const nt=tr.querySelector('#e_note').value; if(!n.trim()||!p.trim()) return alert('Name/Telefon erforderlich'); updateContact(id,{name:n,phone:p,note:nt}); } if(act==='cancel') renderContacts(); });
      $('#exportContacts').addEventListener('click',()=>{ const blob=new Blob([JSON.stringify(state.contacts,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`contacts-${new Date().toISOString().slice(0,10)}.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); });
      $('#importContacts').addEventListener('click',()=>$('#importContactsFile').click());
      $('#importContactsFile').addEventListener('change',async e=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; const text=await f.text(); try{ const data=JSON.parse(text); if(!Array.isArray(data)) throw new Error('Ung√ºltiges Format'); data.forEach(x=>state.contacts.push({id:uid(),name:x.name||'',phone:x.phone||'',note:x.note||''})); save(); renderContacts(); alert('Import fertig'); }catch(err){ alert('Import fehlgeschlagen: '+err.message);} e.target.value=''; });

      // Notes events
      $('#addNote').addEventListener('click',async ()=>{ const title=$('#noteTitle').value; const tags=$('#noteTags').value; const text=$('#noteText').value; const f=$('#noteImage').files[0]; let image=''; if(f){ try{ image=await readAsDataURL(f);}catch{} } if(!title.trim() && !text.trim() && !image) return alert('Bitte mindestens Titel, Text oder Bild angeben.'); addNote({title:title.trim(),tags:tags.trim(),text:text.trim(),image}); $('#noteTitle').value=$('#noteTags').value=$('#noteText').value=''; $('#noteImage').value=''; });
      $('#notesBody').addEventListener('click',e=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; const act=btn.dataset.act; const n=state.notes.find(x=>x.id===id); if(!n) return; if(act==='open') openNoteModal(n); if(act==='del-note'){ if(confirm('Diese Notiz l√∂schen?')) deleteNote(id); }});

      // Cases events
      $('#addCase').addEventListener('click',()=>{ const obj={ title:$('#caseTitle').value.trim(), number:$('#caseNumber').value.trim(), status:$('#caseStatus').value.trim(), people:$('#casePeople').value.trim(), tags:$('#caseTags').value.trim(), desc:$('#caseDesc').value.trim() }; if(!obj.title||!obj.number) return alert('Titel und Aktenzeichen sind erforderlich.'); addCase(obj); $('#caseTitle').value=$('#caseNumber').value=$('#caseStatus').value=$('#casePeople').value=$('#caseTags').value=$('#caseDesc').value=''; });
      $('#casesBody').addEventListener('click',e=>{ const btn=e.target.closest('button'); if(!btn) return; const id=btn.dataset.id; const act=btn.dataset.act; const c=state.cases.find(x=>x.id===id); if(!c) return; if(act==='open-case') openCaseModal(c); if(act==='del-case'){ if(confirm('Diesen Fall l√∂schen?')) deleteCase(id); } });

      // Enter shortcuts
      ['name','phone','note'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('addContact').click(); } }); });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
